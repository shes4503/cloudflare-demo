# Cloudflare Demo Project

本專案展示如何利用 **Cloudflare Workers** 與 **Turnstile**，建立一個模擬登入與註冊的 Demo App，並結合進階的速率限制與流量記錄。

---

## 🚀 專案動機
一般的速率限制規則通常套用在整個網站或單一路徑，容易誤傷正常使用者。  
本專案的目標是：  
- **僅針對「登入」與「註冊」路徑進行限制**，避免惡意濫用。  
- 透過 **Turnstile 驗證** 區分人類與機器人。  
- 將完整請求資料寫入 **R2 儲存體**，補足 Turnstile 儀表板僅提供「查問次數 / 已解決查問 / 解決率」等統計的不足，方便更深入的行為分析。

---

## 🔑 功能特色

### 1. Demo App
- 提供 **登入** 與 **註冊** 頁面，設計成卡片式 UI，簡單易用。  
- 適合用於展示與測試 Turnstile 整合效果。

### 2. Rate Limit Worker
- 僅對特定路徑（`/login`、`/register`）進行速率限制。  
- 若同一個 IP 在短時間內多次嘗試，會觸發 **Turnstile 驗證**。  
- 驗證通過後會自動解除封鎖，允許繼續請求，保障正常玩家體驗。

### 3. 日誌記錄
- 每次請求都會寫入詳細資料（IP、User-Agent、國家、訪問次數、時間戳記等）到 **R2 儲存體**。  
- 採用「每日一檔」的方式儲存，方便後續統計與分析。  
- 管理者可藉此觀察惡意流量模式，例如：  
  - 是否來自特定國家或來源？  
  - 是否有大量相同 IP 短時間重複嘗試？  
  - 是否存在異常的 User-Agent 行為？

---

## 📊 強化分析
Cloudflare Turnstile 儀表板目前僅能提供以下基礎統計：
- **查問結果**：已發出的查問數量  
- **已解決的查問**：成功處理的比例  
- **解決率**：驗證完成率  

這些數據雖能提供大方向參考，但缺乏細部資料。  
因此本專案額外將完整的請求紀錄保存到 **R2**，能補足下列不足：  
- **來源追蹤**：精確到 IP 與 User-Agent。  
- **行為模式**：可分析單一來源的嘗試頻率與分布。  
- **異常流量**：方便比對不同地區或設備是否存在惡意集中攻擊。  

---

## 📂 專案架構

├── demo-worker.js # Demo 登入/註冊頁 Worker
├── ratelimit-worker.js # 限流與驗證 Worker
└── README.md # 專案介紹文件


## 🚀 如何使用
1. 部署 `demo-worker.js` 到 Cloudflare Workers，對外提供 Demo 頁面。  
2. 部署 `ratelimit-worker.js`，並綁定 R2 與 KV Namespace。  

